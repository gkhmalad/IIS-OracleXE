-- USERS definition

CREATE TABLE "USERS" 
   (	"USER_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY, 
	"FIRST_NAME" VARCHAR2(100) NOT NULL ENABLE, 
	"LAST_NAME" VARCHAR2(100) NOT NULL ENABLE, 
	"EMAIL" VARCHAR2(100), 
	 CONSTRAINT "USERS_PK" PRIMARY KEY ("USER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 
  TABLESPACE "USERS"  ENABLE
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;

COMMENT ON TABLE USERS IS 'Stores all of the users.';

-- NOTES definition
CREATE TABLE NOTES (
	NOTE_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
	USER_ID NUMBER,
	TITLE VARCHAR2(100),
	"DATE" VARCHAR2(100),
	"TYPE" VARCHAR2(100),
	"COMMENT" VARCHAR2(100),
	CONSTRAINT NOTES_PK PRIMARY KEY (NOTE_ID)
);


-- NOTES foreign keys

ALTER TABLE NOTES ADD CONSTRAINT FK_USERS FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON DELETE CASCADE;


-- PROCEDURES

CREATE OR REPLACE PROCEDURE add_note (w_id IN NUMBER , w_title IN varchar2, w_date IN varchar2, w_type IN varchar2, w_comment IN varchar2)
IS
BEGIN 
	INSERT INTO NOTES (USER_ID ,TITLE ,"DATE","TYPE","COMMENT")
	VALUES (w_id,w_title,w_date,w_type,w_comment);
	COMMIT;
END;

CREATE OR REPLACE PROCEDURE add_user (w_first IN varchar2, w_last IN varchar2, w_email IN varchar2)
IS
BEGIN 
	INSERT INTO USERS (FIRST_NAME,LAST_NAME,EMAIL)
	VALUES (w_first,w_last,w_email);
	COMMIT;
END;

CREATE OR REPLACE PROCEDURE delete_note (w_id IN NUMBER)
IS
BEGIN 
	DELETE FROM NOTES
	WHERE w_id = NOTES.NOTE_ID;
	COMMIT;
END;

CREATE OR REPLACE PROCEDURE delete_user (w_id IN NUMBER)
IS
BEGIN 
	DELETE FROM USERS
	WHERE w_id = USERS.USER_ID;
	COMMIT;
END;

CREATE OR REPLACE PROCEDURE edit_note (w_id IN NUMBER,w_title IN varchar2, w_date IN varchar2, w_type IN varchar2, w_comment IN varchar2)
IS
BEGIN 
	UPDATE NOTES 
	SET TITLE = w_title,
		"DATE" = w_date,
		"TYPE" = w_type,
		"COMMENT" = w_comment
	WHERE NOTES.NOTE_ID = w_id;
	COMMIT;
END;

CREATE OR REPLACE PROCEDURE edit_user (w_id IN NUMBER,w_email IN varchar2)
IS
BEGIN 
	UPDATE USERS 
	SET EMAIL  = w_email
	WHERE USERS.USER_ID = w_id;
	COMMIT;
END;
